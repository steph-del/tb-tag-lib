<!-- basic tags chips -->
<mat-chip-list>
  <mat-chip *ngFor="let bTag of basicTags" (click)="basicTagClicked(bTag)">{{ bTag.namae }}</mat-chip>
</mat-chip-list>

<!-- user's tags chips -->
<mat-chip-list>
  <mat-chip *ngFor="let uTag of userTagsObservable | async"
            [color]="getTagColor(uTag)"
            selected="true"
            (click)="userTagSelectionChange(uTag)">
            {{ uTag.name }}
            <mat-spinner class="tagSpinner" diameter="16" *ngIf="uTag.linking"></mat-spinner>
            <mat-spinner class="tagSpinner" diameter="16" color="accent" *ngIf="uTag.unlinking"></mat-spinner>
  </mat-chip>
</mat-chip-list>

<!-- tree -->
<mat-tree [dataSource]="treeDataSource" [treeControl]="treeControl" cdkDropList (cdkDropListDropped)="drop($event)">
  <!-- This is the tree node template for leaf nodes -->
  <mat-tree-node *matTreeNodeDef="let node" matTreeNodeToggle matTreeNodePadding cdkDrag [cdkDragData]="node" [disabled]="treeDisabled"
                 (mouseenter)="dragHover(node)" (mouseleave)="dragHoverEnd()" (cdkDragStarted)="dragStart()" (cdkDragReleased)="dragEnd()">
    <!-- use a disabled button to provide padding for tree leaf -->
    <button mat-icon-button disabled></button>

    <mat-checkbox class="checklist-leaf-node"
                  color="primary"
                  *ngIf="!node.linking && !node.unlinking"
                  [checked]="node.selected"
                  (change)="userTagSelectionChange(node)">{{node.name}}</mat-checkbox>
    <mat-spinner class="tagSpinner" diameter="16" *ngIf="node.linking || node.unlinking"></mat-spinner>

    <div class="drag-placeholder" *cdkDragPlaceholder>
      <mat-list role="list"><mat-list-item role="listitem">{{node.name}}</mat-list-item></mat-list>
    </div>
  </mat-tree-node>
    
  <!-- This is the tree node template for expandable nodes -->
  <mat-tree-node *matTreeNodeDef="let node;when: hasChild" matTreeNodeToggle matTreeNodePadding cdkDrag [cdkDragData]="node" [disabled]="treeDisabled"
                 (mouseenter)="dragHover(node)" (mouseleave)="dragHoverEnd()" (cdkDragStarted)="dragStart()" (cdkDragReleased)="dragEnd()">
    <button mat-icon-button matTreeNodeToggle
            [attr.aria-label]="'toggle ' + node.name">
      <mat-icon class="mat-icon-rtl-mirror">
        {{treeControl.isExpanded(node) ? 'expand_more' : 'chevron_right'}}
      </mat-icon>
    </button>

    <mat-checkbox class="checklist-leaf-node"
                  color="primary"
                  *ngIf="!node.linking && !node.unlinking"
                  [checked]="node.selected"
                  (change)="userTagSelectionChange(node)">{{node.name}}</mat-checkbox>
    <mat-spinner class="tagSpinner" diameter="16" *ngIf="node.linking || node.unlinking"></mat-spinner>

    <div class="drag-placeholder" *cdkDragPlaceholder>
      <mat-list role="list"><mat-list-item role="listitem">{{node.name}}</mat-list-item></mat-list>
    </div>
  </mat-tree-node>

</mat-tree>
