<!-- basic tags chips -->
<mat-chip-list>
  <mat-chip *ngFor="let bTag of basicTags" (click)="basicTagClicked(bTag)">{{ bTag.namae }}</mat-chip>
</mat-chip-list>

<!-- user's tags chips -->
<mat-chip-list class="chip-list">
  <mat-chip *ngFor="let uTag of userTagsObservable | async"
            [color]="getTagColor(uTag)"
            selected="true"
            (click)="uTagSelectionChange(uTag)">
            {{ uTag.name }}
            <mat-spinner class="tagSpinner" diameter="16" *ngIf="uTag.linking"></mat-spinner>
            <mat-spinner class="tagSpinner" diameter="16" color="accent" *ngIf="uTag.unlinking"></mat-spinner>
  </mat-chip>
</mat-chip-list>

<!-- tree -->
<div class="tree-wrapper">
  <tree-root
    #treeComponent
    [state]="state"
    [options]="options"
    [focused]="true"
    [nodes]="tree"
    (moveNode)="moveNode($event)">

    <!--<ng-template #treeNodeTemplate let-node let-index="index">
      <div class="tree-row">
          <mat-checkbox
            *ngIf="!node.data.linking && !node.data.unlinking && !node.data.isEditingName && !node.data.isSavingName"
            color="primary"
            [checked]="node.data.selected"
            (change)="uTagSelectionChange(node.data)">
            {{ node.data.name }}
          </mat-checkbox>
          <div *ngIf="node.data.linking || node.data.unlinking || node.data.isSavingName" class="tree-node-crud-operation">
              <mat-spinner diameter="16"></mat-spinner>
              <span>Enregistrement en cours...</span>
          </div>
          <div *ngIf="node.data.isEditingName" class="tree-node-editing-name">
            <mat-form-field>
              <input matInput #newTagName value="{{node.data.name}}" placeholder="Renommer le tag" maxlength="30">
            </mat-form-field>
            <button mat-button (click)="renameTag(node.data, newTagName.value)">Valider</button>
            <button mat-button (click)="stopEditingTagName(node.data)">Annuler</button>
          </div>
          <div class="actions">
            <div class="vertical-separator"></div>
            <div><button mat-icon-button (click)="editTagName(node.data)"><mat-icon>edit</mat-icon></button></div>
            <div><button mat-icon-button><mat-icon>delete</mat-icon></button></div>
          </div>
      </div>
      
    </ng-template>-->

    <ng-template #treeNodeWrapperTemplate let-node let-index="index">
      <div class="node-wrapper" [style.padding-left]="node.getNodePadding()">
        <!--<tree-node-expander [node]="node">-></tree-node-expander>-->
        <div class="my-node-expander" (click)="expandNode(node)">
          <!-- use a disabled button to provide padding for tree leaf -->
          <button mat-icon-button disabled *ngIf="node.isLeaf"></button>
          <button mat-icon-button *ngIf="!node.isLeaf && !node.isExpanded"><mat-icon>chevron_right</mat-icon></button>
          <button mat-icon-button *ngIf="!node.isLeaf && node.isExpanded"><mat-icon>expand_more</mat-icon></button>
        </div>
        <div class="node-content-wrapper"
          [class.node-content-wrapper-active]="node.isActive"
          [class.node-content-wrapper-focused]="node.isFocused"
          (click)="node.mouseAction('click', $event)"
          (dblclick)="node.mouseAction('dblClick', $event)"
          (contextmenu)="node.mouseAction('contextMenu', $event)"
          (treeDrop)="node.onDrop($event)"
          [treeAllowDrop]="node.allowDrop"
          [treeDrag]="node"
          [treeDragEnabled]="node.allowDrag()">
  
          <!--<tree-node-content [node]="node" [index]="index"></tree-node-content>-->
          <div class="tree-row">
              <mat-checkbox
                *ngIf="!node.data.linking && !node.data.unlinking && !node.data.isEditingName && !node.data.isSavingName"
                color="primary"
                [checked]="node.data.selected"
                (change)="uTagSelectionChange(node.data)">
                {{ node.data.name }}
              </mat-checkbox>
              <div *ngIf="node.data.linking || node.data.unlinking || node.data.isSavingName" class="tree-node-crud-operation">
                  <mat-spinner diameter="16"></mat-spinner>
                  <span>Enregistrement en cours...</span>
              </div>
              <div *ngIf="node.data.isEditingName" class="tree-node-editing-name">
                <mat-form-field>
                  <input matInput #newTagName value="{{node.data.name}}" placeholder="Renommer le tag" maxlength="30">
                </mat-form-field>
                <button mat-button (click)="renameTag(node.data, newTagName.value)">Valider</button>
                <button mat-button (click)="stopEditingTagName(node.data)">Annuler</button>
              </div>
              <div class="actions">
                <div class="vertical-separator"></div>
                <div><button mat-icon-button (click)="editTagName(node.data)"><mat-icon>edit</mat-icon></button></div>
                <div><button mat-icon-button><mat-icon>delete</mat-icon></button></div>
              </div>
          </div>


        </div>
      </div>
    </ng-template>

  </tree-root>

  <div *ngIf="apiRenamingTagPath || apiCreatingNewTag" class="api-crud-operation">
      <mat-spinner diameter="16"></mat-spinner>
      <span>Enregistrement en cours...</span>
  </div>

  <button mat-button *ngIf="!isCreatingNewTag && !apiCreatingNewTag" (click)="isCreatingNewTag = true">
    <mat-icon style="margin-right: 10px;">add</mat-icon>Cr√©er un nouveau tag
  </button>

  <div *ngIf="isCreatingNewTag && !apiCreatingNewTag" class="tag-creation">
    <mat-form-field>
      <input matInput #createTagValue placeholder="Nom du nouveau tag">
    </mat-form-field>
    <button mat-button (click)="createNewTag(createTagValue.value)">Valider</button>
    <button mat-button (click)="isCreatingNewTag = false">Annuler</button>
  </div>

</div>

